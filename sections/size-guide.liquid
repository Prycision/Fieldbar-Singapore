{% schema %}
{
  "name": "Size Guide Comparison",
  "tag": "section",
  "class": "size-guide-comparison",
  "settings": [
    {
      "type": "text",
      "id": "left_heading",
      "label": "Heading",
      "default": "Size Guide"
    },
    {
      "type": "textarea",
      "id": "left_intro",
      "label": "Intro Text",
      "default": "While Champagne is always recommended, Fieldbar products are designed to accommodate a broad range of configurations"
    },
    {
      "type": "image_picker",
      "id": "quote_image",
      "label": "Quote Image"
    },
    {
      "type": "richtext",
      "id": "quote_text",
      "label": "Quote"
    },
    {
      "type": "text",
      "id": "quote_author",
      "label": "Quote Author",
      "default": "- Christian Pol Roger"
    }
  ],
  "blocks": [
    {
      "type": "product_block",
      "name": "Product Block",
      "settings": [
        { "type": "image_picker", "id": "main_image", "label": "Main Product Image" },
        { "type": "text", "id": "volume", "label": "Volume Label (e.g. 4L)" },
        { "type": "text", "id": "title", "label": "Product Title" },
        { "type": "text", "id": "dimension", "label": "Dimension" },
        { "type": "url", "id": "product_link", "label": "Shop Now Link" },
        { "type": "text", "id": "link_label", "label": "Shop Now Label", "default": "Shop Now" },
        { "type": "image_picker", "id": "detail_image_1", "label": "Detail Image 1" },
        { "type": "text", "id": "detail_text_1", "label": "Detail Description 1" },
        { "type": "image_picker", "id": "detail_image_2", "label": "Detail Image 2" },
        { "type": "text", "id": "detail_text_2", "label": "Detail Description 2" },
        { "type": "image_picker", "id": "detail_image_3", "label": "Detail Image 3" },
        { "type": "text", "id": "detail_text_3", "label": "Detail Description 3" },
        { "type": "image_picker", "id": "detail_image_4", "label": "Detail Image 4" },
        { "type": "text", "id": "detail_text_4", "label": "Detail Description 4" }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Size Guide Comparison",
      "blocks": [
        { "type": "product_block" },
        { "type": "product_block" },
        { "type": "product_block" }
      ]
    }
  ]
}
{% endschema %}

<div class="size-guide-grid">
  <div class="size-guide-left">
    <h1>{{ section.settings.left_heading }}</h1>
    <p>{{ section.settings.left_intro }}</p>
    <div class="drink-categories">
      <p data-drink="champagne">CHAMPAGNE</p>
      <p data-drink="beer">BEER</p>
      <p data-drink="wine">WINE</p>
      <p data-drink="mixed">MIXED</p>
    </div>
    <div class="quote-text">{{ section.settings.quote_text }}</div>
    <p class="quote-author">{{ section.settings.quote_author }}</p>
    {% if section.settings.quote_image %}
      <div class="quote-image">
        <img src="{{ section.settings.quote_image | image_url: width: 600 }}" alt="Quote image">
      </div>
    {% endif %}
  </div>

  <div class="size-guide-right-wrapper">
    <button class="swiper-btn swiper-prev" aria-label="Previous">‹</button>
    <div class="size-guide-right">
      {% for block in section.blocks %}
        <div class="product-compare">
          <div class="top-sticky-wrapper">
            <div class="top-image">
              {% if block.settings.main_image %}
                <img src="{{ block.settings.main_image | image_url: width: 400 }}" alt="{{ block.settings.title }}">
              {% endif %}
            </div>
            <div class="top-copy">
              <p class="volume-label">{{ block.settings.volume | upcase }}</p>
              <h3>{{ block.settings.title }}</h3>
              <p class="dimension">{{ block.settings.dimension | upcase }}</p>
              <a href="{{ block.settings.product_link }}" class="shop-now">{{ block.settings.link_label }}</a>
            </div>
          </div>

          <div class="details-section">
            {% for i in (1..4) %}
              {% assign img_key = "detail_image_" | append: i %}
              {% assign txt_key = "detail_text_" | append: i %}
              {% assign img = block.settings[img_key] %}
              {% assign txt = block.settings[txt_key] %}
              {% if img %}
                <div
                  class="detail-row"
                  id="drink-{% case i %}{% when 1 %}champagne{% when 2 %}beer{% when 3 %}wine{% when 4 %}mixed{% endcase %}"
                  data-drink="{% case i %}{% when 1 %}champagne{% when 2 %}beer{% when 3 %}wine{% when 4 %}mixed{% endcase %}"
                >
                  <img 
                    src="{{ img | image_url: width: 600 }}"
                    srcset="{{ img | image_url: width: 600 }} 1x, {{ img | image_url: width: 1200 }} 2x"
                    alt="{{ txt | strip_html | truncate: 50 }}"
                    loading="lazy"
                    style="width: 100%; height: auto;"
                  >
                  <p>{{ txt }}</p>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
    <button class="swiper-btn swiper-next" aria-label="Next">›</button>
  </div>
</div>

<style>
  .size-guide-grid {
    display: flex;
    width: 100vw;
    background: #F3EFEB;
  }
  .size-guide-left {
    width: 30vw;
    height: 100vh;
    position: sticky;
    top: 0;
    padding: 3rem 2rem;
    background: #F3EFEB;
    box-sizing: border-box;
  }
  .size-guide-left h1 {
    text-align: center;
  }
  .quote-author, .quote-text {
    text-align: center;
  }

  .drink-categories {
    display: none;
  }

  .drink-categories p.active {
    color: #FF8A3D;
  }

  .quote-image img {
    width: 95%;
    height: 30vh;
    object-fit: contain;
  }

  .size-guide-right-wrapper {
    position: relative;
    width: 70vw;
    display: flex;
    align-items: center;
  }

  .size-guide-right {
    display: flex;
    scroll-behavior: smooth;
    background: #F3EFEB;
  }

  .product-compare {
    flex: 0 0 calc(70vw / 3);
    display: flex;
    flex-direction: column;
    background: #F3EFEB;
  }

  .top-sticky-wrapper {
    position: sticky !important;
    top: 0;
    z-index: 1;
    background: #F3EFEB;
    height: 32vh;
    display: flex;
    flex-direction: column;
  }
  .top-image {
    flex: 0 0 55%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  .top-image img {
    width: 100%;
    height: 150%;
    object-fit: contain;
  }
  .top-copy {
    flex: 0 0 45%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0 1em;
    gap: 0.25em;
    box-sizing: border-box;
  }
  .top-copy h3{
    margin: 0;
    padding:0;
  }
  .volume-label, .dimension {
    text-align: center;
    font-size: 0.8em;
    text-transform: uppercase;
    color: #486A7A;
    margin: 0;
  }
  .top-copy .shop-now {
    display: inline-block;
    position: relative;
    padding-bottom: 2px;
    text-decoration: none;
    color: #002B4D;
    font-size: 0.8em;
    text-transform: uppercase;
  }
  .top-copy .shop-now::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 2px;
    background: #FF8A3D;
    transform: scaleX(1);
    transform-origin: right;
    transition: transform 0.4s ease;
  }
  .top-copy .shop-now:hover {
    color: #FF8A3D;
  }
  .top-copy .shop-now:hover::after {
    transform: scaleX(0);
  }

  .details-section {
    padding: 1.5rem;
  }
  .detail-row {
    text-align: center;
    margin: 0.5em 0;
    font-size: 0.8em;
  }
  .detail-row img {
    max-width: 105%;
    margin-bottom: -1em;
    mix-blend-mode: darken;
  }

  .swiper-btn {
    display: none !important;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.8);
    border: none;
    font-size: 2rem;
    padding: 0.2rem 0.5rem;
    cursor: pointer;
    z-index: 2;
  }
  .swiper-prev { left: 0; }
  .swiper-next { right: 0; }

  @media screen and (max-width: 768px) {
    .size-guide-grid {
      flex-direction: column;
    }
    .size-guide-left,
    .size-guide-right-wrapper {
      width: 100vw;
      height: auto;
      top: auto;
      padding: 1rem;
    }
    .size-guide-left {
     text-align: center;
    }
    .quote-text,
    .quote-author,
    .quote-image {
      display: none !important;
    }
    .swiper-btn {
      display: block !important;
      top: 8.5vh !important;
      font-size: 3rem;
    }
    .drink-categories {
      display: none;
    }
    .size-guide-right {
      overflow-x: auto;
    }
    .product-compare {
      flex: 0 0 50%;
      padding-right: 1rem;
    }
    .top-copy .shop-now{
    text-align: center;
   }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const container = document.querySelector(".size-guide-right");
    const prev = document.querySelector(".swiper-prev");
    const next = document.querySelector(".swiper-next");
    const slideWidth = () => container.clientWidth / (window.innerWidth < 769 ? 2 : 3);

    prev.addEventListener("click", () => {
      container.scrollBy({ left: -slideWidth(), behavior: "smooth" });
    });

    next.addEventListener("click", () => {
      container.scrollBy({ left: slideWidth(), behavior: "smooth" });
    });

    document.querySelectorAll('.drink-categories p').forEach(p => {
      p.addEventListener('click', () => {
        const target = document.querySelector(`.detail-row[data-drink="${p.dataset.drink}"]`);
        if (target) {
          const offset = target.getBoundingClientRect().top + window.pageYOffset - 100;
          window.scrollTo({ top: offset, behavior: "smooth" });
        }
      });
    });

    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const currentDrink = entry.target.dataset.drink;
          document.querySelectorAll('.drink-categories p').forEach(p => {
            p.classList.toggle('active', p.dataset.drink === currentDrink);
          });
        }
      });
    }, { threshold: 0.5 });

    document.querySelectorAll('.detail-row[data-drink]').forEach(el => observer.observe(el));
  });
</script>
