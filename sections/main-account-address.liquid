{{ 'account-owners-club.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .tt-shopping-layout .tt-title.bsm-tt-title {
    padding-bottom: 0 !important;
  }
  .tt-table-shop-01.tt-table-address {
    border-bottom: 1px solid var(--shopify-editor-setting-color_line);
    width: 40%;
  }
  @media (max-width: 575px) {
    .tt-table-shop-01.tt-table-address {
      width: 100%;
    }
  }
  @media screen and (min-width: 61.8125em) {
    .container-indent {
      width: 50%;
      margin-left: auto;
      margin-right: auto;
    }

    .top_address {
      padding-left: 1em;
    }
  }
  @media screen and (max-width: 61.8125em) {
    .container-indent {
      width: 95%;
      margin-left: auto;
      margin-right: auto;
    }

    .top_address {
      padding-left: 1em;
    }
  }
  #Layer_1 {
    height: 1em;
    color: #002b4d !important;
    margin-right: 1em;
  }

  a {
    text-decoration: none;
    font-family: 'Gotham Medium' !important;
    color: #002b4d;
    font-size: 12px;
    letter-spacing: .5px;
  }

  .owners-club-wrapper {
    background: #f3efeb;
    padding: 40px 20px;
    max-width: 1000px;
    margin: auto;
    font-family: 'Gotham Narrow Book' !important;
    color: #002b4d;
    text-align: center;
  }

  .owners-header {
    margin-bottom: 30px;
  }

  td {
    font-family: 'Gotham Narrow Book' !important;
  }
  .tt-link-back {
    font-family: 'Gotham Medium' !important;
    color: #002b4d !important;
  }

  .checkbox-group {
    display: inline-flex;
  }

  .owners-header .header-actions {
    font-size: 12px;
    text-transform: uppercase;
    font-family: 'Gotham Medium' !important;
    letter-spacing: .5px;
  }

  .owners-header .header-actions button {
    background: none;
    border: none;
    padding: 0;
    margin: 0 5px;
    color: #002b4d;
    font-size: 12px;
    font-family: 'Gotham Medium' !important;
    text-transform: uppercase;
    cursor: pointer;
  }

  .owners-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 30px;
    flex-wrap: nowrap;
  }

  .owners-buttons .fieldbar_button {
    min-width: 220px;
    font-family: 'Gotham Medium' !important;
    text-transform: uppercase;
    font-weight: bold;
    cursor: pointer;
    padding: 14px 24px;
  }

  @media screen and (max-width: 767px) {
    .owners-buttons {
      flex-direction: column;
      align-items: center;
    }
  }

  .order-summary-wrapper {
    background-color: #ffffff;
    padding: 40px 20px;
    margin-top: 40px;
    font-family: 'Gotham Narrow Book' !important;
  }

  .order-summary-wrapper h2 {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 20px;
    text-transform: uppercase;
    font-family: 'Gotham Medium' !important;
    text-align: center;
  }

  .order-table-wrapper {
    overflow-x: auto;
  }

  .order-history {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    min-width: 700px;
  }

  .order-history thead th {
    text-align: left;
    padding: 12px;
    background-color: #f3efeb;
    font-family: 'Gotham Medium' !important;
    text-transform: uppercase;
    color: #002b4d;
    border-bottom: 2px solid #ccc;
  }

  .order-history tbody td {
    padding: 12px;
    border-bottom: 1px solid #eee;
    color: #002b4d;
  }

  .order-history a {
    color: #002b4d;
    font-weight: bold;
  }

  .no-orders-message {
    font-size: 14px;
    color: #999;
    margin-top: 20px;
    text-align: center;
  }

  /* Address specific styles */
  .bsm-address-wrapper {
    margin-top: 20px;
  }

  .bsm-address {
    margin-bottom: 30px;
    padding: 20px;
    background: #fff;
    border: 1px solid #e0e0e0;
  }

  .bsm-address-title {
    font-size: 16px;
    color: #002b4d;
    margin-bottom: 15px;
  }

  .bsm-address-sub {
    font-weight: normal;
    color: #666;
  }

  .tt-shop-btn {
    margin-top: 15px;
  }

  .tt-shop-btn a {
    margin-right: 15px;
  }

  [id^='edit_address_'],
  #add_address {
    background-color: #f9f9f9;
    border: 1px solid #e3e3e3;
    padding: 30px;
    margin-top: 30px;
  }

  [id^='edit_address_'] .form-default,
  #add_address .form-default {
    font-family: 'Gotham Medium'
    , sans-serif;
  }

  /* Form group styles */
  [id^='edit_address_'] .form-group,
  #add_address .form-group {
    margin-bottom: 20px;
  }

  /* Label styles */
  [id^='edit_address_'] label,
  #add_address label {
    display: block;
    font-size: 13px;
    color: #002b4d;
    margin-bottom: 6px;
    text-transform: uppercase;
    font-weight: 500;
  }

  /* Input field styles */
  [id^='edit_address_'] input[type='text'],
  [id^='edit_address_'] select,
  [id^='edit_address_'] input[type='tel'],
  #add_address input[type='text'],
  #add_address select,
  #add_address input[type='tel'] {
    width: 100%;
    padding: 12px;
    font-size: 14px;
    border: 1px solid #ccc;
    background: #fff;
    font-family: 'Gotham Medium'
    , sans-serif;
  }

  /* Checkbox styles */
  [id^='edit_address_'] .checkbox-group,
  #add_address .checkbox-group {
    margin-top: 20px;
  }

  [id^='edit_address_'] .checkbox-group label,
  #add_address .checkbox-group label {
    font-size: 14px;
    display: flex;
    align-items: center;
    text-transform: none;
  }

  [id^='edit_address_'] .checkbox-group .check,
  [id^='edit_address_'] .checkbox-group .box,
  #add_address .checkbox-group .check,
  #add_address .checkbox-group .box {
    display: inline-block;
    margin-right: 6px;
  }

  [id^='edit_address_'] .tt-link,
  #add_address .tt-link {
    color: #002b4d;
    text-decoration: underline;
    font-weight: 500;
    margin-left: 8px;
    font-family: 'Gotham Medium'
    , sans-serif;
    font-size: 13px;
  }

  @media screen and (max-width: 767px) {
    [id^='edit_address_'],
    #add_address {
      padding: 20px;
    }

    [id^='edit_address_'] .row.tt-offset-21,
    #add_address .row.tt-offset-21 {
      flex-direction: column;
      gap: 15px;
    }

    [id^='edit_address_'] .col-auto,
    #add_address .col-auto {
      width: 100%;
    }
  }

  /* Additional styles for the add address form */
  #add_address {
    display: none;
    /* Hidden by default */
  }

  #add_address .tt-title {
    font-size: 18px;
    color: #002b4d;
    margin-bottom: 20px;
    text-transform: uppercase;
  }

  .tt-table-address {
    width: 100%;
  }
  td:first-child {
    padding-top: 3px;
    word-wrap: anywhere;
    line-break: normal;
    width: 40%;
  }
  tbody {
    width: 100%;
  }
{%- endstyle -%}

<div class="owners-club-wrapper">
  <div class="owners-header">
    <div class="welcome-line">Welcome {{ customer.first_name }}
    </div>
    <div class="header-actions">
      <button onclick="window.location.href='/account?view=profile'">View Profile
      </button>
      |
      <button onclick="window.location.href='{{ routes.account_logout_url }}'">Log Out
      </button>
      |
    {% comment %}
      <button onclick="togglePasswordForm()">Reset Password</button>
    {% endcomment %}
    </div>
  </div>
  <script>
    function togglePasswordForm() {
      const form = document.getElementById('password_reset_form');
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }
  </script>
  <div class="owners-buttons">
    <button onclick="window.location.href='/account?view=register'" class="fieldbar_button">
      Register a New Product
    </button>
    <button onclick="window.location.href='/account?view=registered-products'" class="fieldbar_button">
      MAKE A CLAIM
    </button>
    <button onclick="window.location.href='/account?view=summary'" class="fieldbar_button ">View Order History
    </button>
  </div>
</div>

{% comment %}
  <div id="password_reset_form" class="password-reset-form" style="display:none;">
  {% render 'reset' %}
  </div>
{% endcomment %}

{% paginate customer.addresses by 5 %}
  <div class="container-indent">
    <div class="container">
      <div class="tt-shopping-layout">
        <div class="tt-wrapper">
          <div class="top_address">
            <h2>EDIT ADDRESSES ({{ customer.addresses_count }})
            </h2>
            <a href="{{ routes.account_url }}?view=profile" class="tt-link-back">
              <i class="icon-e-19"></i>
              Return to your Profile
            </a>
          </div>

          {% if customer.addresses.size == 0 %}
            <div class="tt-wrapper" style="margin-top:15px">
              <a
                href="#"
                onclick="Shopify.CustomerAddress.toggleNewForm(); return false;"
                class="btn btn-border ttbtnmainstyle">
                {{- 'customer.addresses.add_new' | t -}}
              </a>
              <br>
            </div>
          {% endif %}

          <div class="bsm-address-wrapper">
            {% if customer.addresses.size > 0 %}
              {% for address in customer.addresses %}
                <div id="view_address_{{address.id}}" class="tt-wrapper bsm-address">
                  <h2 class="tt-title bsm-address-title">
                    {% if address == customer.default_address -%}
                      PRIMARY ADDRESS -
                    {% else -%}
                      SECONDARY ADDRESS -
                    {% endif %}
                    <span class="bsm-address-sub">
                      {{ address.street }}
                    </span>
                  </h2>
                  <div class="tt-table-responsive1">
                    <table class="tt-table-shop-01 tt-table-address">
                      <tbody>
                        <tr>
                          <td>
                            {{ 'customer.account.name' | t }}
                          </td>
                          <td>
                            {{ address.first_name }}
                            {{ address.last_name }}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {{ 'customer.account.email' | t }}
                          </td>
                          <td>
                            {{ customer.email }}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {{ 'customer.account.company' | t }}
                          </td>
                          <td>
                            {{ address.company }}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {{ 'customer.account.address' | t }}
                          </td>
                          <td>
                            {{ address.street }}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {{ 'customer.account.country' | t }}
                          </td>
                          <td>
                            {{ address.country }}, {{ address.city }}
                            {% if address.province_code %}, {{ address.province_code }}
                            {% endif %}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {{ 'customer.account.zip' | t }}
                          </td>
                          <td>
                            {{ address.zip }}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {{ 'customer.account.phone' | t }}
                          </td>
                          <td>
                            {{ address.phone }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="tt-shop-btn">
                    <a
                      href="#"
                      onclick="Shopify.CustomerAddress.toggleForm({{ address.id }});return false"
                      class="btn-link svg-icon-pencil-inline">
                      {% include 'svg-pencil' -%}
                      {{- 'customer.addresses.edit' | t }}
                    </a>
                    <a
                      href="#"
                      onclick="Shopify.CustomerAddress.destroy({{ address.id }}, 'Are you sure you wish to delete this address?');return false"
                      class="btn-link svg-icon-delete-inline">
                      {% include 'svg-delete-icon' -%}
                      {{- 'customer.addresses.delete' | t }}
                    </a>
                  </div>
                </div>

                <div
                  id="edit_address_{{address.id}}"
                  class="tt-wrapper"
                  style="display:none;">
                  <div class="form-default">
                    {% form 'customer_address'
                      , address %}
                      <div class="form-group">
                        <label for="shopInputFirstName" class="control-label">
                          {{- 'customer.addresses.first_name' | t -}}
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[first_name]"
                          value="{{form.first_name}}"
                          id="shopInputFirstName">
                      </div>
                      <div class="form-group">
                        <label for="shopInputLastName" class="control-label">
                          {{- 'customer.addresses.last_name' | t -}}
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[last_name]"
                          value="{{form.last_name}}"
                          id="shopInputLastName">
                      </div>
                      <div class="form-group">
                        <label for="shopCompanyName" class="control-label">
                          {{- 'customer.addresses.company' | t -}}
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[company]"
                          value="{{form.company}}"
                          id="shopCompanyName">
                      </div>
                      <div class="form-group">
                        <label for="shopAddress" class="control-label">
                          {{ 'customer.addresses.address1' | t }}
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[address1]"
                          value="{{form.address1}}"
                          id="shopAddress">
                      </div>
                      <div class="form-group">
                        <label for="shopAddress2" class="control-label">
                          {{ 'customer.addresses.address2' | t }}
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[address2]"
                          value="{{form.address2}}"
                          id="shopAddress2">
                      </div>
                      <div class="form-group">
                        <label for="shopTown" class="control-label">
                          {{ 'customer.addresses.city' | t }}
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[city]"
                          value="{{form.city}}"
                          id="shopTown">
                      </div>
                      <div class="form-group">
                        <label for="address_country_{{form.id}}">
                          {{ 'customer.addresses.country' | t }}
                        </label>
                        <select
                          id="address_country_{{form.id}}"
                          class="form-control"
                          name="address[country]"
                          data-default="{{ form.country }}">
                          {{ country_option_tags }}
                        </select>
                      </div>
                      <div
                        id="address_province_container_{{form.id}}"
                        style="display:none"
                        class="form-group">
                        <label for="address_province_{{form.id}}">
                          {{ 'customer.addresses.province' | t }}
                        </label>
                        <select
                          id="address_province_{{form.id}}"
                          class="form-control"
                          name="address[province]"
                          data-default="{{ form.province }}"></select>
                      </div>
                      <div class="form-group">
                        <label for="shopPostCode" class="control-label">
                          {{ 'customer.addresses.zip' | t }}
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[zip]"
                          value="{{form.zip}}"
                          id="shopPostCode">
                      </div>
                      <div class="form-group">
                        <label for="shopPhone" class="control-label">
                          {{ 'customer.addresses.phone' | t }}
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          name="address[phone]"
                          value="{{form.phone}}"
                          id="shopPhone">
                      </div>

                      <div class="checkbox-group">
                        <input
                          type="checkbox"
                          id="address_default_address_{{ address.id }}"
                          name="address[default]"
                          value="1">
                        <label for="address_default_address_{{ address.id }}">
                          <span class="check"></span>
                          <span class="box"></span>
                          {{ 'customer.addresses.set_default' | t }}
                        </label>
                      </div>

                      <div class="row tt-offset-21">
                        <div class="col-auto">
                          <button type="submit" class="fieldbar_button">
                            {{ 'customer.addresses.update' | t }}
                          </button>
                        </div>
                        <div class="col-auto align-self-center">
                          {{ 'customer.general.or' | t }}
                          <a
                            href="#"
                            onclick="Shopify.CustomerAddress.toggleForm({{form.id}}); return false;"
                            class="tt-link">
                            {{- 'customer.addresses.cancel' | t -}}
                          </a>
                        </div>
                      </div>
                    {% endform %}
                  </div>
                </div>
              {% endfor %}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% if paginate.pages > 1 %}{% include 'pagination'
  , align: ' tt-pagination-left' %}
  {% endif %}
</div>
{% endpaginate %}

  <div
  id="add_address"
  class="tt-wrapper"
  style="display:none;">
  <h6 class="tt-title">
    {{ 'customer.addresses.add_new' | t }}
  </h6>
  <div class="form-default">
    {% form 'customer_address'
      , customer.new_address %}
      <div class="form-group">
        <label for="address_first_name_new">
          {{ 'customer.addresses.first_name' | t }}
        </label>
        <input
          type="text"
          id="address_first_name_new"
          class="form-control"
          name="address[first_name]"
          value="{{form.first_name}}">
      </div>
      <div class="form-group">
        <label for="address_last_name_new">
          {{ 'customer.addresses.last_name' | t }}
        </label>
        <input
          type="text"
          id="address_last_name_new"
          class="form-control"
          name="address[last_name]"
          value="{{form.last_name}}">
      </div>
      <div class="form-group">
        <label for="address_company_new">
          {{ 'customer.addresses.company' | t }}
        </label>
        <input
          type="text"
          id="address_company_new"
          class="form-control"
          name="address[company]"
          value="{{form.company}}">
      </div>
      <div class="form-group">
        <label for="address_address1_new">
          {{ 'customer.addresses.address1' | t }}
        </label>
        <input
          type="text"
          id="address_address1_new"
          class="form-control"
          name="address[address1]"
          value="{{form.address1}}">
      </div>
      <div class="form-group">
        <label for="address_address2_new">
          {{ 'customer.addresses.address2' | t }}
        </label>
        <input
          type="text"
          id="address_address2_new"
          class="form-control"
          name="address[address2]"
          value="{{form.address2}}">
      </div>
      <div class="form-group">
        <label for="address_city_new">
          {{ 'customer.addresses.city' | t }}
        </label>
        <input
          type="text"
          id="address_city_new"
          class="form-control"
          name="address[city]"
          value="{{form.city}}">
      </div>
      <div class="form-group">
        <label for="address_country_new">
          {{ 'customer.addresses.country' | t }}
        </label>
        <select
          id="address_country_new"
          class="form-control"
          name="address[country]"
          data-default="{{ form.country }}">
          {{ country_option_tags }}
        </select>
      </div>
      <div
        id="address_province_container_new"
        style="display:none"
        class="form-group">
        <label for="address_province_new">
          {{ 'customer.addresses.province' | t }}
        </label>
        <select
          id="address_province_new"
          class="form-control"
          name="address[province]"
          data-default="{{ form.province }}"></select>
      </div>
      <div class="form-group">
        <label for="address_zip_new">
          {{ 'customer.addresses.zip' | t }}
        </label>
        <input
          type="text"
          id="address_zip_new"
          class="form-control"
          name="address[zip]"
          value="{{form.zip}}">
      </div>
      <div class="form-group">
        <label for="address_phone_new">
          {{ 'customer.addresses.phone' | t }}
        </label>
        <input
          type="tel"
          id="address_phone_new"
          class="form-control"
          name="address[phone]"
          value="{{form.phone}}">
      </div>

      <div class="checkbox-group">
        {{ form.set_as_default_checkbox }}
        <label for="address_default_address_new">
          <span class="check"></span>
          <span class="box"></span>
          {{ 'customer.addresses.set_default' | t }}
        </label>
      </div>

      <div class="row tt-offset-21">
        <div class="col-auto">
          <button
            class="fieldbar_button"
            type="submit"
            class="btn">
            {{ 'customer.addresses.add' | t }}
          </button>
        </div>
        <div class="col-auto align-self-center">
          {{ 'customer.general.or' | t }}
          <a
            href="#"
            onclick="Shopify.CustomerAddress.toggleNewForm(); return false;"
            class="tt-link">
            {{ 'customer.addresses.cancel' | t }}
          </a>
        </div>
      </div>
    {% endform %}
  </div>
</div>

<script>
  // Initialize country/province selectors
  document.addEventListener("DOMContentLoaded", function() {
    // New address form
    if (document.getElementById('address_country_new')) {
      new Shopify.CountryProvinceSelector(
        'address_country_new',
        'address_province_new',
        {hideElement: 'address_province_container_new'}
      );
    }

    // Edit address forms
    {% for address in customer.addresses %}
      if (document.getElementById('address_country_{{ address.id }}')) {
        new Shopify.CountryProvinceSelector(
          'address_country_{{ address.id }}',
          'address_province_{{ address.id }}',
          {hideElement: 'address_province_container_{{ address.id }}'}
        );
      }
    {% endfor %}

    // Handle form submissions
    document.querySelectorAll('form[action$="/addresses"]').forEach(form => {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch(this.action, {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => {
          if (response.ok) {
            window.location.reload();
          } else {
            response.json().then(data => {
              alert(data.description || 'Error saving address. Please try again.');
            }).catch(() => {
              alert('Error saving address. Please try again.');
            });
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error saving address. Please try again.');
        });
      });
    });
  });

  // Fix for the search modal error
  document.addEventListener("DOMContentLoaded", function() {
    if (typeof this.searchModal === 'undefined' || this.searchModal === null) {
      console.log('Search modal not found - ignoring error');
    }
  });
</script>

<script>
  // Custom implementation of Shopify.CustomerAddress if not defined
  if (typeof Shopify === 'undefined') {
    var Shopify = {};
  }
  if (typeof Shopify.CustomerAddress === 'undefined') {
    Shopify.CustomerAddress = {
      toggleForm: function(id) {
        var editEl = document.getElementById('edit_address_' + id);
        var viewEl = document.getElementById('view_address_' + id);
        if (editEl && viewEl) {
          editEl.style.display = editEl.style.display === 'none' ? 'block' : 'none';
          viewEl.style.display = viewEl.style.display === 'none' ? 'block' : 'none';
        }
        return false;
      },
      toggleNewForm: function() {
        var el = document.getElementById('add_address');
        if (el) {
          el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }
        return false;
      },
      destroy: function(id, confirm_msg) {
        if (confirm(confirm_msg || "Are you sure you wish to delete this address?")) {
          var form = document.createElement('form');
          form.method = 'post';
          form.action = '/account/addresses/' + id;

          var methodInput = document.createElement('input');
          methodInput.type = 'hidden';
          methodInput.name = '_method';
          methodInput.value = 'delete';
          form.appendChild(methodInput);

          document.body.appendChild(form);
          form.submit();
        }
      }
    };
  }

  // Initialize country/province selectors
  document.addEventListener("DOMContentLoaded", function() {
    // New address form
    if (document.getElementById('address_country_new')) {
      new Shopify.CountryProvinceSelector(
        'address_country_new',
        'address_province_new',
        {hideElement: 'address_province_container_new'}
      );
    }

    // Edit address forms
    {% for address in customer.addresses %}
      if (document.getElementById('address_country_{{ address.id }}')) {
        new Shopify.CountryProvinceSelector(
          'address_country_{{ address.id }}',
          'address_province_{{ address.id }}',
          {hideElement: 'address_province_container_{{ address.id }}'}
        );
      }
    {% endfor %}

    // Handle form submissions
    document.querySelectorAll('form[action$="/addresses"]').forEach(form => {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch(this.action, {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => {
          if (response.ok) {
            window.location.reload();
          } else {
            response.json().then(data => {
              alert(data.description || 'Error saving address. Please try again.');
            }).catch(() => {
              alert('Error saving address. Please try again.');
            });
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error saving address. Please try again.');
        });
      });
    });
  });

  // Fix for the search modal error
  document.addEventListener("DOMContentLoaded", function() {
    if (typeof this.searchModal === 'undefined' || this.searchModal === null) {
      console.log('Search modal not found - ignoring error');
    }
  });
</script>

{% schema %}
  {
    "name": "Edit Addresses",
    "settings": []
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
